# 路由规则配置说明

## 简介

框架为单页应用型框架，路由系统为前端掌控，基于第三方`director.js`封装了框架路由，从而使得单页应用也能够在浏览器中指定url进行访问。通过地址`哈希值`的变化来渲染对应的页面。

**哈希值主要是url`#`后面的字符串，以下说明统称为`路由`**

框架的路由配置在`appConfig`里的`routes`对象中。主要结构如下：

```
routes: {
    "/main": {
        // 框架
        on: "frame_index",
        // 首页
        "/index": "main_index",
        "/demo/:id":"demo_index",
        "/userInfo/:type/:id":{
            on:"userInfo_index",
            "/test":"userInfo_test_index"
        },
        "/resetPwd":"resetPwd_index",
        // 潜客跟进
        "/potentialCusSet":{
            on:"potentialCusSet_index"
        }
    },
     //企业注册
    "/register":"register_index",
    "/findPwd":"findPwd_index",
    "/login": "login_login"
}
```

主要是一个json结构，其中每个节点的对象名表示的是路由，后面紧跟着的值代表的是控制器在`modules`文件夹下的路径`path`，以便找到对应的控制器并进行渲染。

### 单层路由

比如访问`#/resetPwd`时，那么路由系统会去执行`/modules/register/index.js`控制器。

### 多层路由

比如访问`#/main/index`时，**由于是多层结构**，那么路由系统会从第一层开始遍历，直到各个结构层所遍历的对象名**拼接**起来和访问的`#/main/index`匹配一致，则表示找到该控制器，所要执行的控制器就在`/index`后的`main_index`,也就是`/modules/main/index.js`。遍历完成之后，路由系统会从上往下顺序执行每个存在`遍历树`内的控制器，除特殊情况外。

### 带参数路由

比如访问`#/main/demo/1`时，由于是多层结构，遍历规则同上，直到找到`/demo/:id`，由于该路由规则支持接受参数id，所以这个时候id为1。

**注意，对象名不能全部都是参数，必须带有固定值**

### 带on的结构

当我们访问`#/main/index`的时候，由于`/index`前有个`on属性`那么则表示当路由匹配跑到这个结构中来的时候都会去执行on后面对应的控制器，但是会分以下几种情况：

+ 访问`#/main`时，无论`frame_index`控制器对象设置`type`属性与否，都会执行。
+ 访问`#/main/index`时，当`frame_index`控制器对象设置了`type`属性为`container`，控制器`frame_index`会执行，否则不会执行。

**对于最后执行的控制器，`type`属性无效，都会执行**

## 默认框架模块sweet.pageMenu_index

为了让框架使用者开发便利，框架有提供了自己默认的一些模块。

### 附属菜单模块

附属菜单模块是在左侧主菜单右边衍生的一个菜单结构ui，在配置了`appConfig`的相关`pageMenu`的配置后，在所需要的路由中配置一个`外框类的节点`。例如：

```
// 文档
"/docs":{
    on:"sweet.pageMenu_index",
    "/index":"docs_main_index",
    "/rule":"docs_rule_index",
    "/API":"docs_api_index",
    "/controller":"docs_controller_index",
    "/viewsEngine":"docs_viewsEngine_index",
    "/director":"docs_director_index"
},
```

**`sweet.pageMenu_index`控制器代表的是附属菜单控制器模块，所有的框架默认的模块的`path`均要加上`sweet.`前缀，其物理地址在与`modules`同级的`sweet/defaults`下**


当访问`#/docs/index`时，那么根据`带on的结构`的描述，则会去依次执行`sweet.pageMenu_inde`、`docs_main_index`控制器。

由于配置了附属菜单模块，那么其下的子控制器对象的`renderer.container`均要设置为`#frame-pageMenu-main`。